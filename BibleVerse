#!/bin/bash

# BibleVerse - TempleOS inspired random Bible verse generator
# In Memory of Terry A. Davis (1969-2018)

# Directory where the script is located (follow symlinks)
SCRIPT_SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SCRIPT_SOURCE" ]; do
  SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_SOURCE")" && pwd)"
  SCRIPT_SOURCE="$(readlink "$SCRIPT_SOURCE")"
  [[ $SCRIPT_SOURCE != /* ]] && SCRIPT_SOURCE="$SCRIPT_DIR/$SCRIPT_SOURCE"
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_SOURCE")" && pwd)"
VERSES_FILE="$SCRIPT_DIR/verses.txt"

# Colors for TempleOS-style output
RED='\033[1;31m'
BLUE='\033[1;34m'
CYAN='\033[1;36m'
YELLOW='\033[1;33m'
GREEN='\033[1;32m'
MAGENTA='\033[1;35m'
WHITE='\033[1;37m'
RESET='\033[0m'

# Check if verses file exists
if [ ! -f "$VERSES_FILE" ]; then
    echo -e "${RED}Error: verses.txt not found in $SCRIPT_DIR${RESET}"
    exit 1
fi

# Get total number of verses
TOTAL_VERSES=$(wc -l < "$VERSES_FILE")

# Generate random verse number (1 to TOTAL_VERSES)
RANDOM_LINE=$((RANDOM % TOTAL_VERSES + 1))

# Get the random verse
VERSE_LINE=$(sed -n "${RANDOM_LINE}p" "$VERSES_FILE")

# Split into reference and text
REFERENCE=$(echo "$VERSE_LINE" | cut -d'|' -f1)
TEXT=$(echo "$VERSE_LINE" | cut -d'|' -f2)

# Special rendering for certain verses
if [[ "$REFERENCE" == "Matthäus 7:6" ]]; then
    clear
    echo ""
    echo -e "${MAGENTA}╔═══════════════════════════════════════════════════════════════════════╗${RESET}"
    echo -e "${MAGENTA}║                                                                       ║${RESET}"
    echo -e "${MAGENTA}║${YELLOW}                  ✧･ﾟ: *✧･ﾟ:* HEILIGE WARNUNG *:･ﾟ✧*:･ﾟ✧                 ${MAGENTA}║${RESET}"
    echo -e "${MAGENTA}║                                                                       ║${RESET}"
    echo -e "${MAGENTA}╚═══════════════════════════════════════════════════════════════════════╝${RESET}"
    echo ""
    echo -e "${RED}                              ⚠️  ACHTUNG  ⚠️                              ${RESET}"
    echo ""
    echo -e "${CYAN}              Du hast durch Gottes Zufall eine besondere${RESET}"
    echo -e "${CYAN}                     Botschaft empfangen!${RESET}"
    echo ""
    echo -e "${WHITE}╔═══════════════════════════════════════════════════════════════════════╗${RESET}"
    echo -e "${WHITE}║                                                                       ║${RESET}"
    echo -e "${YELLOW}║  ${REFERENCE}                                                        ║${RESET}"
    echo -e "${WHITE}║                                                                       ║${RESET}"
    echo -e "${GREEN}║  \"$TEXT\"  ║${RESET}"
    echo -e "${WHITE}║                                                                       ║${RESET}"
    echo -e "${WHITE}╚═══════════════════════════════════════════════════════════════════════╝${RESET}"
    echo ""
    echo -e "${MAGENTA}              ┌─────────────────────────────────────────┐              ${RESET}"
    echo -e "${MAGENTA}              │  ${YELLOW}✦ TERRY DAVIS WUSSTE ES ✦${MAGENTA}          │              ${RESET}"
    echo -e "${MAGENTA}              │                                         │              ${RESET}"
    echo -e "${MAGENTA}              │  ${WHITE}God's Random Number Generator${MAGENTA}       │              ${RESET}"
    echo -e "${MAGENTA}              │  ${WHITE}hat gesprochen!${MAGENTA}                     │              ${RESET}"
    echo -e "${MAGENTA}              │                                         │              ${RESET}"
    echo -e "${MAGENTA}              │  ${CYAN}Hüte die Perlen der Weisheit.${MAGENTA}       │              ${RESET}"
    echo -e "${MAGENTA}              │  ${CYAN}Teile sie nur mit den Würdigen.${MAGENTA}     │              ${RESET}"
    echo -e "${MAGENTA}              └─────────────────────────────────────────┘              ${RESET}"
    echo ""
    echo -e "${RED}                    ═══════════════════════════════                        ${RESET}"
    echo -e "${YELLOW}                          In Memory of Terry A. Davis                       ${RESET}"
    echo -e "${YELLOW}                              TempleOS (1969-2018)                           ${RESET}"
    echo -e "${RED}                    ═══════════════════════════════                        ${RESET}"
    echo ""
else
    # Normal verse display (TempleOS style)
    echo ""
    echo -e "${CYAN}╔═══════════════════════════════════════════════════════════════════════╗${RESET}"
    echo -e "${CYAN}║${YELLOW}                            GOD SAYS:${CYAN}                                 ║${RESET}"
    echo -e "${CYAN}╚═══════════════════════════════════════════════════════════════════════╝${RESET}"
    echo ""
    echo -e "${BLUE}  ┌─────────────────────────────────────────────────────────────────┐${RESET}"
    echo -e "${BLUE}  │  ${WHITE}${REFERENCE}${BLUE}$(printf '%*s' $((62 - ${#REFERENCE})) '')│${RESET}"
    echo -e "${BLUE}  └─────────────────────────────────────────────────────────────────┘${RESET}"
    echo ""

    # Word wrap the text to fit nicely
    echo -e "${GREEN}  \"${TEXT}\"${RESET}" | fold -s -w 69
    echo ""
    echo -e "${CYAN}  ────────────────────────────────────────────────────────────────${RESET}"
    echo -e "${YELLOW}              Press F7 for another verse (or run again)${RESET}"
    echo -e "${CYAN}  ────────────────────────────────────────────────────────────────${RESET}"
    echo ""
fi
